{% extends "base.html" %}
{% block content %}
<h1 class="text-center mb-3">Your Cart</h1>

{% if items %}
<form action="{{ url_for('update_cart') }}" method="post" class="cart-form">
  <table class="cart-table">
    <thead>
      <tr>
        <th>Image</th>
        <th>Product</th>
        <th>Price</th>
        <th>Qty</th>
        <th>Subtotal</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for it in items %}
      <tr>
        <td>
          {% if it.image %}
            <img src="{{ url_for('static', filename='uploads/' ~ it.image) }}" alt="{{ it.name }}" class="cart-thumb">
          {% endif %}
        </td>
        <td>{{ it.name }}</td>
        <td>₱{{ "%.2f"|format(it.price) }}</td>
        <td>
          {% if it.stock > 0 %}
            <input type="number" name="qty_{{ it.cart_id }}" value="{{ it.quantity }}" min="1" max="{{ items.stock }}" class="cart-qty">
            <small class="text-muted">Stock: {{ it.stock }}</small>
            {% else %}
            <span class="text-danger">Sold Out</span>
          {% endif %}
        </td>
        <td>
          {% if it.stock > 0 %}
            ₱{{ "%.2f"|format(it.price * it.quantity) }}
          {% else %}
            ₱0.00
          {% endif %}
        </td>
        <td>
          <form action="{{ url_for('remove_from_cart', cart_id=it.cart_id) }}" method="post" onsubmit="return confirm('Remove this item?')">
            <button type="submit" class="btn btn-danger btn-sm">❌ Remove</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="cart-actions">
    <button type="submit" class="btn btn-primary">Update Cart</button>
    <form action="{{ url_for('clear_cart') }}" method="post" onsubmit="return confirm('Clear all items?')">
      <button type="submit" class="btn btn-secondary">Clear Cart</button>
    </form>
  </div>
</form>

<div class="cart-summary">
  <h3>Total: <span class="text-primary">₱{{ "%.2f"|format(total) }}</span></h3>

  <h3 class="mt-2">Checkout</h3>
  <form action="{{ url_for('checkout') }}" method="post" class="checkout-form">
    <input type="text" name="name" placeholder="Full Name" required>
    <input type="email" name="email" placeholder="Email Address" required>
    <button type="submit" class="btn btn-primary mt-2">Place Order</button>
  </form>
</div>

{% else %}
<p class="text-center text-muted">Your cart is empty.</p>
{% endif %}
{% endblock %}
